<!-- Modal Overlay -->
<div 
  class="fixed inset-0 bg-black/50 z-[100] backdrop-blur-sm animate-fade-in" 
  (click)="onClose()"
  role="button"
  tabindex="0"
  aria-label="Cerrar modal">
</div>

<!-- Modal Content -->
<div class="fixed inset-0 flex items-center justify-center z-[110] p-4 animate-slide-up pointer-events-none">
  <div 
    class="pointer-events-auto relative bg-white rounded-2xl shadow-2xl w-full max-w-3xl mx-auto overflow-hidden max-h-[90vh] overflow-y-auto custom-scrollbar"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modal-title">
    
    <!-- Botón cerrar -->
    <button 
      class="absolute top-4 right-4 z-10 bg-white hover:bg-red-50 text-gray-500 hover:text-red-600 transition-all duration-200 font-bold w-10 h-10 rounded-full shadow-lg hover:shadow-xl flex items-center justify-center group" 
      (click)="onClose()"
      aria-label="Cerrar ventana">
      <svg class="w-5 h-5 group-hover:rotate-90 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>

    <!-- Header -->
    <div class="p-6 bg-gradient-to-r from-blue-100 to-blue-50 border-b border-blue-200">
      <div class="flex items-start justify-between pr-8">
        <div>
          <div class="text-xs text-gray-600 font-medium uppercase tracking-wide">Código - Secuencia</div>
          <div class="text-sm text-blue-900 font-bold">{{boleta?.codigo_encabezado || '—'}}-{{boleta?.secuencia}}</div>
        </div>
        <div class="text-center">
          <h2 class="text-2xl font-extrabold text-blue-900 tracking-tight" id="modal-title">BOLETA DE PAGO</h2>
          <div class="text-xs text-gray-600 mt-1">{{boleta?.tipo_pensionista ? 'PENSIONISTA' : 'TRABAJADOR'}}</div>
        </div>
        <div class="text-right">
          <div class="text-xs text-gray-600">UGEL / RUC</div>
          <div class="text-sm font-semibold text-gray-800">{{boleta?.ruc_bloque || '20188468706'}}</div>
          <div class="mt-2 text-lg font-extrabold text-red-600 uppercase">{{boleta?.mes}} {{boleta?.anio}}</div>
        </div>
      </div>
    </div>

    <!-- Datos Personales -->
    <div class="px-6 py-4">
      <div class="text-sm font-bold text-blue-900 border-b border-blue-200 pb-1 mb-3">DATOS PERSONALES</div>
      <div class="grid grid-cols-3 gap-4 text-sm">
        <div>
          <div class="text-xs text-gray-500 mb-1">Apellidos</div>
          <div class="font-semibold text-gray-900 uppercase">{{boleta?.apellidos}}</div>
        </div>
        <div>
          <div class="text-xs text-gray-500 mb-1">Nombres</div>
          <div class="font-semibold text-gray-900 uppercase">{{boleta?.nombres}}</div>
        </div>
        <div>
          <div class="text-xs text-gray-500 mb-1">DNI</div>
          <div class="font-semibold text-gray-900 font-mono">{{boleta?.documento_identidad}}</div>
        </div>
      </div>
    </div>

    <!-- Información Laboral/Pensión -->
    <div class="px-6 py-4 bg-gray-50">
      <div class="grid grid-cols-2 gap-x-6 gap-y-3 text-xs">
        <div>
          <span class="text-gray-600">Centro de Trabajo:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.establecimiento || '—'}}</span>
        </div>
        <div>
          <span class="text-gray-600">Cargo:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.cargo}}</span>
        </div>
        <div>
          <span class="text-gray-600">Tipo Servidor:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.tipo_servidor || boleta?.tipo_pensionista || '—'}}</span>
        </div>
        <div *ngIf="boleta?.tipo_pension">
          <span class="text-gray-600">Tipo de Pensión:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.tipo_pension}}</span>
        </div>
        <div *ngIf="!boleta?.tipo_pension">
          <span class="text-gray-600">Régimen Laboral:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.regimen_pensionario || '—'}}</span>
        </div>
        <div>
          <span class="text-gray-600">Nivel Mag./Horas:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.nivel_mag_horas}}</span>
        </div>
        <div class="col-span-2">
          <span class="text-gray-600">Leyenda:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.leyenda_permanente}}</span>
        </div>
        <div>
          <span class="text-gray-600">Cuenta:</span>
          <span class="ml-2 font-semibold text-gray-900 font-mono">{{boleta?.cuenta_principal}}</span>
        </div>
        <div *ngIf="boleta?.reg_pensionario_detalle?.afiliacion">
          <span class="text-gray-600">Afiliación:</span>
          <span class="ml-2 font-semibold text-gray-900">{{boleta?.reg_pensionario_detalle?.afiliacion}}</span>
        </div>
      </div>
    </div>

    <!-- Ingresos y Descuentos -->
    <div class="px-6 py-4">
      <div class="grid grid-cols-2 gap-4">
        <!-- Ingresos -->
        <div class="border border-green-200 rounded-lg overflow-hidden">
          <div class="bg-green-100 text-green-800 text-xs font-semibold px-3 py-2">INGRESOS</div>
          <div class="max-h-48 overflow-y-auto">
            <table class="w-full text-xs">
              <tbody>
                <tr *ngFor="let concepto of boleta?.conceptos" 
                    [class.hidden]="concepto.tipo !== 'INGRESO'"
                    class="border-b last:border-0">
                  <td class="px-3 py-2 text-gray-700">{{concepto.concepto}}</td>
                  <td class="px-3 py-2 text-right font-semibold text-green-700">{{concepto.monto | currency:'S/ '}}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="bg-green-50 px-3 py-2 flex justify-between items-center text-xs font-semibold">
            <span>TOTAL</span>
            <span class="text-green-700">{{boleta?.total_remuneraciones | currency:'S/ '}}</span>
          </div>
        </div>

        <!-- Descuentos -->
        <div class="border border-red-200 rounded-lg overflow-hidden">
          <div class="bg-red-100 text-red-800 text-xs font-semibold px-3 py-2">DESCUENTOS</div>
          <div class="max-h-48 overflow-y-auto">
            <table class="w-full text-xs">
              <tbody>
                <tr *ngFor="let concepto of boleta?.conceptos" 
                    [class.hidden]="concepto.tipo !== 'DESCUENTO'"
                    class="border-b last:border-0">
                  <td class="px-3 py-2 text-gray-700">{{concepto.concepto}}</td>
                  <td class="px-3 py-2 text-right font-semibold text-red-700">{{concepto.monto | currency:'S/ '}}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="bg-red-50 px-3 py-2 flex justify-between items-center text-xs font-semibold">
            <span>TOTAL</span>
            <span class="text-red-700">{{boleta?.total_descuentos | currency:'S/ '}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Totales -->
    <div class="px-6 py-4 bg-gradient-to-r from-blue-50 to-green-50">
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-white border-2 border-green-300 rounded-lg p-4 text-center">
          <div class="text-xs text-gray-600 font-semibold mb-1">TOTAL LÍQUIDO</div>
          <div class="text-2xl font-extrabold text-green-700">{{boleta?.total_liquido | currency:'S/ '}}</div>
        </div>
        <div class="bg-white border-2 border-blue-300 rounded-lg p-4 text-center">
          <div class="text-xs text-gray-600 font-semibold mb-1">AFECTO A CARGAS SOCIALES</div>
          <div class="text-2xl font-extrabold text-blue-700">{{boleta?.monto_imponible | currency:'S/ '}}</div>
        </div>
      </div>
    </div>

    <!-- Mensaje -->
    <div class="px-6 py-4 text-xs text-gray-600 border-t">
      <strong>MENSAJE:</strong> {{boleta?.leyenda_mensual || 'Visite la página web del Ministerio de Educación: www.gob.pe/minedu'}}
    </div>

    <!-- Botón Imprimir -->
    <div class="px-6 pb-6">
      <a
        *ngIf="boleta?.id !== undefined && boleta?.id !== null"
        [href]="'/boleta/' + boleta?.id"
        target="_blank"
        rel="noopener"
        class="flex items-center justify-center gap-2 w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg font-semibold"
        aria-label="Imprimir boleta">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
        </svg>
        Imprimir Boleta
      </a>
    </div>

  </div>
</div>