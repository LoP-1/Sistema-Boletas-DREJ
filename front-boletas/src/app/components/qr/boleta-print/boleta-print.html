<div>
  <!-- Estado de carga y errores -->
  <div *ngIf="cargando" class="text-center text-blue-700 mt-6">Cargando boleta...</div>
  <div *ngIf="!cargando && error" class="text-center text-red-600 mt-6">{{ error }}</div>

  <!-- Contenido de boleta -->
  <div *ngIf="!cargando && !error" class="max-w-[210mm] mx-auto bg-white p-8 print:p-0">

    <!-- Primera fila: Logo más grande | Espacio flexible | UGEL/RUC -->
    <div class="flex items-center justify-between mb-2 print:mb-1">
      <!-- Logo más grande (izquierda) -->
      <div class="flex-shrink-0" style="width: 60%;">
        <img src="logo-2.png" alt="Perú - Ministerio de Educación" class="w-full h-auto max-h-20 object-contain print:max-h-16">
      </div>

      <!-- Espacio flexible (centro) -->
      <div class="flex-grow"></div>

      <!-- UGEL/RUC (derecha) -->
      <div class="text-right flex-shrink-0">
        <div class="text-sm font-bold text-gray-700">JUNÍN</div>
        <div class="text-xs text-gray-600">DRE JUNÍN</div>
        <div class="text-xs font-semibold text-gray-800">RUC 20188468706</div>
      </div>
    </div>

    <!-- Segunda fila: Código modular | BOLETA DE PAGO | Mes-Año -->
    <div class="grid grid-cols-3 gap-4 items-center mb-4 print:mb-3">
      <!-- Código modular y secuencia (izquierda) -->
      <div class="text-left">
        <div class="text-[10px] text-gray-500">CÓDIGO MODULAR - SECUENCIA</div>
        <div class="text-xs font-bold text-gray-800">
          {{ boleta?.codigo_encabezado || '' }}-{{ boleta?.secuencia }}
        </div>
        <div class="text-[9px] text-gray-600 mt-1">TIPO DE PLANILLA: {{ tipoServidor }}</div>
      </div>

      <!-- Título BOLETA DE PAGO (centro) -->
      <div class="text-center">
        <h1 class="text-2xl font-bold text-gray-800">BOLETA DE PAGO</h1>
      </div>

      <!-- Mes y año (derecha) -->
      <div class="text-right">
        <div class="text-lg font-bold text-orange-500 uppercase">
          {{ boleta?.mes }} - {{ boleta?.anio }}
        </div>
      </div>
    </div>

    <!-- Datos personales en formato horizontal 3 columnas BALANCEADAS -->
    <div class="border border-gray-300 mb-4">
      <!-- Header con fondo celeste/azul claro y tipo de planilla -->
      <div class="flex justify-between items-center bg-blue-100 px-3 py-1 border-b border-gray-300">
        <div class="text-xs font-bold text-gray-800">DATOS PERSONALES</div>
        <div class="text-[10px] font-semibold text-gray-700">TIPO DE PLANILLA: {{ boleta?.estado }}</div>
      </div>

      <!-- Contenido en 3 columnas principales - 5 filas cada una -->
      <div class="grid grid-cols-3 text-[11px]">
        
        <!-- COLUMNA 1 -->
        <div class="border-r border-gray-300">
          <!-- Fila 1: Apellidos -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">APELLIDOS</div>
            <div class="font-bold text-gray-900">{{ boleta?.apellidos }}</div>
          </div>
          
          <!-- Fila 2: Cargo -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">CARGO</div>
            <div class="font-bold text-gray-900">{{ boleta?.cargo }}</div>
          </div>
          
          <!-- Fila 3: Leyenda Permanente -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">LEYENDA PERMANENTE</div>
            <div class="font-bold text-gray-900">{{ boleta?.leyenda_permanente || '--' }}</div>
          </div>
          
          <!-- Fila 4: Situación -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">SITUACIÓN</div>
            <div class="font-bold text-gray-900">{{ boleta?.estado }}</div>
          </div>
          
          <!-- Fila 5: Código Modular IE -->
          <div class="px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">CÓDIGO MODULAR-IE</div>
            <div class="font-bold text-gray-900">{{ boleta?.codigo_encabezado || '--' }}</div>
          </div>
        </div>

        <!-- COLUMNA 2 -->
        <div class="border-r border-gray-300">
          <!-- Fila 1: Nombres -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">NOMBRES</div>
            <div class="font-bold text-gray-900">{{ boleta?.nombres }}</div>
          </div>
          
          <!-- Fila 2: Vínculo Laboral -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">VÍNCULO LABORAL</div>
            <div class="font-bold text-gray-900">{{ boleta?.tipo_pension || '--' }}</div>
          </div>
          
          <!-- Fila 3: Doc. de Referencia -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">DOC. DE REFERENCIA</div>
            <div class="font-bold text-gray-900">{{ boleta?.leyenda_mensual || '--' }}</div>
          </div>
          
          <!-- Fila 4: Jornada Laboral -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">JORNADA LABORAL</div>
            <div class="font-bold text-gray-900">{{ boleta?.nivel_mag_horas || '--' }}</div>
          </div>
          
          <!-- Fila 5: Régimen Pensionario -->
          <div class="px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">RÉGIMEN PENSIONARIO</div>
            <div class="font-bold text-gray-900">{{ boleta?.reg_pensionario_detalle?.afiliacion || '--' }}</div>
          </div>
        </div>

        <!-- COLUMNA 3 -->
        <div>
          <!-- Fila 1: DNI -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">D.N.I</div>
            <div class="font-bold text-gray-900">{{ boleta?.documento_identidad }}</div>
          </div>
          
          <!-- Fila 2: Tipo Servidor -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">TIPO SERVIDOR</div>
            <div class="font-bold text-gray-900">{{ tipoServidor }}</div>
          </div>
          
          <!-- Fila 3: Fecha Nacimiento -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">FECHA NACIMIENTO</div>
            <div class="font-bold text-gray-900">{{ formatFecha(boleta?.fecha_nacimiento) }}</div>
          </div>
          
          <!-- Fila 4: Término -->
          <div class="border-b border-gray-300 px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">TÉRMINO</div>
            <div class="font-bold text-gray-900">{{ formatFecha(boleta?.fecha_termino_registro) }}</div>
          </div>
          
          <!-- Fila 5: Régimen Laboral / Escala Magisterial -->
          <div class="px-3 py-2">
            <div class="text-gray-600 text-[10px] mb-0.5">RÉGIMEN LABORAL</div>
            <div class="font-bold text-gray-900">{{ boleta?.regimen_pensionario || '--' }}</div>
          </div>
        </div>

      </div>
    </div>

    <!-- Ingresos y Descuentos -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <!-- Ingresos -->
      <div class="border border-gray-300">
        <div class="bg-blue-100 px-3 py-1 border-b border-gray-300">
          <div class="text-xs font-bold text-blue-800">INGRESOS</div>
        </div>
        <div class="grid grid-cols-2 text-xs border-b border-gray-300 bg-gray-50">
          <div class="px-3 py-1 font-bold text-gray-700 border-r border-gray-300">CONCEPTO</div>
          <div class="px-3 py-1 font-bold text-gray-700 text-right">MONTO</div>
        </div>
        <div *ngFor="let ing of ingresos" class="grid grid-cols-2 text-xs border-b border-gray-300">
          <div class="px-3 py-1 border-r border-gray-300">{{ ing.concepto }}</div>
          <div class="px-3 py-1 text-right">S/ {{ ing.monto | number:'1.2-2' }}</div>
        </div>
        <div *ngIf="ingresos.length === 0" class="px-3 py-6 text-xs text-gray-400 italic text-center">
          Sin ingresos
        </div>
        <!-- Espaciador para igualar altura -->
        <div *ngFor="let i of [].constructor(Math.max(0, descuentos.length - ingresos.length))" 
             class="grid grid-cols-2 text-xs border-b border-gray-300">
          <div class="px-3 py-1 border-r border-gray-300">&nbsp;</div>
          <div class="px-3 py-1 text-right">&nbsp;</div>
        </div>
      </div>

      <!-- Descuentos -->
      <div class="border border-gray-300">
        <div class="bg-blue-100 px-3 py-1 border-b border-gray-300">
          <div class="text-xs font-bold text-blue-800">DESCUENTOS</div>
        </div>
        <div class="grid grid-cols-2 text-xs border-b border-gray-300 bg-gray-50">
          <div class="px-3 py-1 font-bold text-gray-700 border-r border-gray-300">CONCEPTO</div>
          <div class="px-3 py-1 font-bold text-gray-700 text-right">MONTO</div>
        </div>
        <div *ngFor="let desc of descuentos" class="grid grid-cols-2 text-xs border-b border-gray-300">
          <div class="px-3 py-1 border-r border-gray-300">{{ desc.concepto }}</div>
          <div class="px-3 py-1 text-right">S/ {{ desc.monto | number:'1.2-2' }}</div>
        </div>
        <div *ngIf="descuentos.length === 0" class="px-3 py-6 text-xs text-gray-400 italic text-center">
          Sin descuentos
        </div>
        <!-- Espaciador para igualar altura -->
        <div *ngFor="let i of [].constructor(Math.max(0, ingresos.length - descuentos.length))" 
             class="grid grid-cols-2 text-xs border-b border-gray-300">
          <div class="px-3 py-1 border-r border-gray-300">&nbsp;</div>
          <div class="px-3 py-1 text-right">&nbsp;</div>
        </div>
      </div>
    </div>

    <!-- Totales -->
    <div class="grid grid-cols-2 gap-4 mb-4">
      <div class="border border-gray-300">
        <div class="bg-blue-50 px-3 py-2 flex justify-between items-center">
          <span class="text-xs font-bold text-gray-800">TOTAL INGRESOS</span>
          <span class="text-sm font-bold text-gray-900">S/ {{ boleta?.total_remuneraciones | number:'1.2-2' }}</span>
        </div>
      </div>
      <div class="border border-gray-300">
        <div class="bg-blue-50 px-3 py-2 flex justify-between items-center">
          <span class="text-xs font-bold text-gray-800">TOTAL DESCUENTOS</span>
          <span class="text-sm font-bold text-gray-900">S/ {{ boleta?.total_descuentos | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>

    <!-- QR y Totales finales -->
    <div class="grid grid-cols-12 gap-0 border border-gray-300">
      <div class="col-span-4 p-4 border-r border-gray-300 flex flex-col items-center justify-center">
        <img *ngIf="qrDataUrl" [src]="qrDataUrl" alt="QR Boleta" class="w-32 h-32 mb-2" />
        <div class="text-[9px] text-gray-600 text-center leading-tight">
          La presentación de la boleta de pago electrónica<br>
          podrá ser verificada a través del código QR
        </div>
      </div>
      <div class="col-span-8 p-0">
        <!-- Total líquido -->
        <div class="grid grid-cols-2 border-b border-gray-300">
          <div class="px-3 py-2 bg-blue-100 text-xs font-bold text-gray-800 border-r border-gray-300">TOTAL LÍQUIDO</div>
          <div class="px-3 py-2 bg-blue-50 text-sm font-bold text-gray-900 text-right">S/ {{ boleta?.total_liquido | number:'1.2-2' }}</div>
        </div>
        <!-- Afecto a cargas sociales -->
        <div class="grid grid-cols-2 border-b border-gray-300">
          <div class="px-3 py-2 bg-blue-50 text-xs text-gray-700 border-r border-gray-300">AFECTO A CARGAS SOCIALES</div>
          <div class="px-3 py-2 bg-blue-50 text-sm font-bold text-gray-900 text-right">S/ {{ boleta?.monto_imponible | number:'1.2-2' }}</div>
        </div>
        <!-- Mensaje -->
        <div class="px-3 py-2 border-b border-gray-300">
          <div class="text-[10px] font-bold text-gray-800 mb-1">MENSAJE</div>
          <div class="text-[9px] text-gray-600">Visite la página web del Ministerio de Educación: www.gob.pe/minedu</div>
        </div>
        <!-- Mensaje ecológico -->
        <div class="px-3 py-2 flex items-center gap-3">
          <div class="flex-shrink-0">
            <svg class="w-8 h-8 text-green-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L8 8h8l-4-6z"/>
              <path d="M10 7L6 13h12l-4-6H10z"/>
              <path d="M8 12L4 18h16l-4-6H8z"/>
              <rect x="10" y="18" width="4" height="4" fill="currentColor"/>
            </svg>
          </div>
          <div class="text-[9px] text-gray-600 leading-tight">
            Antes de imprimir esta boleta de pago, piense en su responsabilidad social y compromiso con el medio ambiente.
          </div>
        </div>
      </div>
    </div>

    <!-- Cuenta bancaria -->
    <div class="mt-4 text-xs text-gray-600">
      <span class="font-bold">ENTIDAD BANCARIA:</span> BCO. NACIÓN
      <span class="ml-4 font-bold">Cuenta Principal:</span> {{ boleta?.cuenta_principal || '--' }}
    </div>

    <!-- Botones de acción -->
    <div class="mt-6 flex items-center justify-between print:hidden">
      <button (click)="imprimir()" class="px-5 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
        Imprimir
      </button>
      <a [href]="shareUrl" target="_blank" class="text-blue-700 underline text-sm">Abrir enlace de esta boleta</a>
    </div>
  </div>
</div>